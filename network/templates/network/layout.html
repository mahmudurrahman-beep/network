{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=yes" />
  <title>{% block title %}Argon{% endblock %}</title>

  <!-- Bootstrap 4 CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" crossorigin="anonymous">

  <!-- Global base styles -->
  <link rel="stylesheet" href="{% static 'network/styles.css' %}"> 

  <!-- small page-safe override for Bootstrap 4 close button (Argon look) -->
  <style>
    /* Make sure Bootstrap 4 close button is visible and matches Argon look */
    .close {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(90deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9));
      box-shadow: 0 6px 18px rgba(6,98,150,0.06);
      border: none;
      color: var(--brand-blue, #0E6196);
      font-size: 18px;
      line-height: 1;
      opacity: 0.95;
    }
    .close:focus { outline: none; box-shadow: 0 6px 18px rgba(6,98,150,0.12); }
    /* Keep alerts responsive and remove stray markers */
    .alert { position:relative; display:flex; align-items:center; gap:0.75rem; padding:0.75rem 1rem; margin:0; max-width:100%; box-sizing:border-box; }
    .alert::before { content:none !important; }
  </style>

  {% block extra_head %}{% endblock %}
</head>
<body>
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="{% url 'index' %}">
        <span class="argon-logo" aria-hidden="true">
          <span class="char">A</span>
          <span class="char clock-r">r</span>
          <span class="char earth-g">g</span>
          <span class="char">o</span>
          <span class="char">n</span>
        </span>
        <span class="sr-only">Argon</span>
      </a>

      <button id="navToggler" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="hamburger" aria-hidden="true"><span></span><span></span><span></span></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          {% if user.is_authenticated %}
            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.url_name == 'profile' %}active{% endif %}" href="{% url 'profile' user.username %}">
                <strong>{{ user.username }}</strong>
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.url_name == 'discover_users' %}active{% endif %}" href="{% url 'discover_users' %}">Discover</a>
            </li>

            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.url_name == 'new_post' %}active{% endif %}" href="{% url 'new_post' %}">New Post</a>
            </li>

            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.url_name == 'all_posts' %}active{% endif %}" href="{% url 'all_posts' %}">All Posts</a>
            </li>

            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.url_name == 'following' %}active{% endif %}" href="{% url 'following' %}">Following</a>
            </li>

            <li class="nav-item position-relative">
              <a class="nav-link {% if request.resolver_match.url_name == 'messages_inbox' %}active{% endif %}" href="{% url 'messages_inbox' %}">Messages
                {% if unread_messages_count > 0 %}
                  <span class="badge badge-danger rounded-pill position-absolute top-0 start-100 translate-middle p-1">{{ unread_messages_count }}</span>
                {% endif %}
              </a>
            </li>

            <li class="nav-item position-relative">
              <a class="nav-link {% if request.resolver_match.url_name == 'notifications' %}active{% endif %}" href="{% url 'notifications' %}">Notifications
                {% if unread_notifications_count > 0 %}
                  <span class="badge badge-danger rounded-pill position-absolute top-0 start-100 translate-middle p-1">{{ unread_notifications_count }}</span>
                {% endif %}
              </a>
            </li>

            <li class="nav-item"><a class="nav-link" href="{% url 'logout' %}">Log Out</a></li>
          {% else %}
            <li class="nav-item"><a class="nav-link {% if request.resolver_match.url_name == 'login' %}active{% endif %}" href="{% url 'login' %}">Log In</a></li>
            <li class="nav-item"><a class="nav-link {% if request.resolver_match.url_name == 'register' %}active{% endif %}" href="{% url 'register' %}">Register</a></li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-4">
    {% block body %}{% endblock %}
  </main>

  <footer class="site-footer" role="contentinfo">
    <div class="links"><a href="mailto:mahmudurrahman23yahoo@gmail.com">Contact</a></div>
    <small>Â© {{ now.year }} Argon Network</small>
  </footer>

  <!-- CSRF Token (REQUIRED for Django forms) -->
  <form style="display: none;">
    {% csrf_token %}
  </form>

  <!-- Bootstrap JS + dependencies (Bootstrap 4) -->
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>

  <!-- site main JS -->
  <script src="{% static 'network/js/main.js' %}"></script>

  <!-- Small alert helper: auto-fade and remove after 6s (non-intrusive) -->
  <script>
    (function(){
      // Auto-dismiss transient alerts after 6s
      document.addEventListener('DOMContentLoaded', function(){
        const alerts = document.querySelectorAll('.alert-dismissible');
        alerts.forEach((a) => {
          // only auto-dismiss if not marked data-no-autohide
          if (!a.hasAttribute('data-no-autohide')) {
            setTimeout(() => {
              $(a).fadeTo(300, 0).slideUp(300, function(){ $(this).alert('close'); });
            }, 6000);
          }
        });
      });
    })();
  </script>

  {% block extra_scripts %}{% endblock %}
</body>
</html>
