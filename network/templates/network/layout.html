<!--
================================================================================
ARGON SOCIAL NETWORK - BASE LAYOUT TEMPLATE
================================================================================
@file        layout.html
@author      Argon Admin
@date        February 2026
FEATURES: Navigation, authentication, notifications, PWA support
BLOCKS: title, body (child templates override these)
================================================================================
-->

{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=yes" />
  <title>{% block title %}Argon{% endblock %}</title>

  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'icons/apple-touch-icon.png' %}">
  <link rel="icon" type="image/svg+xml" href="{% static 'icons/favicon.svg' %}">

  <!-- ========== PWA CONFIGURATION ========== -->
  <link rel="manifest" href="{% static 'icons/site.webmanifest' %}">

  <!-- iOS Safari PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Argon">

  <!-- Theme Colors -->
  <meta name="theme-color" content="#0E6196">
  <meta name="msapplication-TileColor" content="#0E6196">
  <!-- ========== END PWA CONFIGURATION ========== -->

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" crossorigin="anonymous">
  
  <!-- Font Awesome (Bootstrap 4 compatible) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  
  <!-- ========== YOUR CUSTOM CSS ========== -->
  <link rel="stylesheet" href="{% static 'network/styles.css' %}">
</head> 
<body>
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="{% url 'index' %}">
        <span class="argon-logo" aria-hidden="true">
          <span class="char">A</span>
          <span class="char clock-r">r</span>
          <span class="char earth-g">g</span>
          <span class="char">o</span>
          <span class="char">n</span>
        </span>
        <span class="sr-only">Argon</span>
      </a>

      <button id="navToggler" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="hamburger" aria-hidden="true"><span></span><span></span><span></span></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          {% if user.is_authenticated %}
            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.url_name == 'profile' %}active{% endif %}" href="{% url 'profile' user.username %}">
                <strong>{{ user.username }}</strong>
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.url_name == 'discover_users' %}active{% endif %}" href="{% url 'discover_users' %}">Discover</a>
            </li>

            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.url_name == 'all_posts' %}active{% endif %}" href="{% url 'all_posts' %}">All Posts</a>
            </li>

            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.url_name == 'following' %}active{% endif %}" href="{% url 'following' %}">Following</a>
            </li>

            <li class="nav-item position-relative">
              <a class="nav-link {% if request.resolver_match.url_name == 'messages_inbox' %}active{% endif %}" href="{% url 'messages_inbox' %}">Messages
              <span class="badge badge-danger badge-pill nav-badge js-message-badge" style="display: none;">
                  {{ unread_messages_count }}
              </span>
              </a>
            </li>

            <li class="nav-item position-relative">
              <a class="nav-link {% if request.resolver_match.url_name == 'notifications' %}active{% endif %}" href="{% url 'notifications' %}">Notifications
                {% if unread_notifications_count > 0 %}
                  <span class="badge badge-danger badge-pill nav-badge">{{ unread_notifications_count }}</span>
                {% endif %}
              </a>
            </li>

            <li class="nav-item"><a class="nav-link" href="{% url 'logout' %}">Log Out</a></li>
          {% else %}
            <li class="nav-item"><a class="nav-link {% if request.resolver_match.url_name == 'login' %}active{% endif %}" href="{% url 'login' %}">Log In</a></li>
            <li class="nav-item"><a class="nav-link {% if request.resolver_match.url_name == 'register' %}active{% endif %}" href="{% url 'register' %}">Register</a></li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav>

<main class="container my-4">
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    {% endfor %}
  {% endif %}

  {% block body %}{% endblock %}
</main>

  <footer class="site-footer" role="contentinfo">
    <div class="links"><a href="mailto:mahmudurrahman23yahoo@gmail.com">Contact</a></div>
    <small>© {{ now.year }} Argon Network</small>
  </footer>

  <!-- CSRF Token (REQUIRED for Django forms) -->
  <form style="display: none;">
    {% csrf_token %}
  </form>
  <script>
  // Set authentication state for main.js
  window.userAuthenticated = {% if user.is_authenticated %}true{% else %}false{% endif %};
</script> 
  <!-- Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>

  <!-- Your Custom JS -->
  <script src="{% static 'network/js/main.js' %}"></script>

  <script>
    (function(){
      const toggler = document.getElementById('navToggler');
      const hamburger = toggler && toggler.querySelector('.hamburger');
      const collapse = document.getElementById('navbarNav');
      const originalParent = collapse && collapse.parentNode;
      let placeholder = null;

      if (toggler && hamburger && collapse) {
        toggler.addEventListener('click', function(){
          hamburger.classList.toggle('open');
          const expanded = this.getAttribute('aria-expanded') === 'true';
          this.setAttribute('aria-expanded', String(!expanded));
        });

        $(collapse).on('shown.bs.collapse', function () {
          if (!placeholder) {
            placeholder = document.createElement('div');
            placeholder.style.display = 'none';
            originalParent.insertBefore(placeholder, collapse);
          }
          document.body.appendChild(collapse);
          const navHeight = document.querySelector('.navbar').offsetHeight || 64;
          collapse.style.top = (navHeight + 8) + 'px';
          collapse.style.left = '12px';
          collapse.style.right = '12px';
          collapse.style.zIndex = getComputedStyle(document.documentElement).getPropertyValue('--nav-panel-z') || 999999;
          collapse.classList.add('show');
          document.body.style.overflow = 'hidden';
        });

        $(collapse).on('hidden.bs.collapse', function () {
          hamburger.classList.remove('open');
          collapse.classList.remove('show');
          setTimeout(() => {
            if (placeholder && originalParent) {
              originalParent.insertBefore(collapse, placeholder);
              placeholder.remove();
              placeholder = null;
            }
            collapse.style.top = '';
            collapse.style.left = '';
            collapse.style.right = '';
            collapse.style.zIndex = '';
            document.body.style.overflow = '';
          }, 260);
        });

        window.addEventListener('resize', function(){
          if (collapse.classList.contains('show')) {
            const navHeight = document.querySelector('.navbar').offsetHeight || 64;
            collapse.style.top = (navHeight + 8) + 'px';
          }
        });
      }

      function setupClockTick(selector, direction = 1, stepDeg = 6, tickDuration = 1000, pauseDuration = 2000) {
        const els = document.querySelectorAll(selector);
        els.forEach(el => {
          let angle = 0;
          function tickOnce() {
            angle = (angle + stepDeg * direction) % 360;
            el.style.transition = `transform ${tickDuration}ms ease-in-out`;
            el.style.transform = `rotate(${angle}deg)`;
            setTimeout(() => {
              el.style.transition = '';
              setTimeout(tickOnce, pauseDuration);
            }, tickDuration);
          }
          setTimeout(tickOnce, 600);
        });
      }

      setupClockTick('.navbar .clock-r', +1, 6, 1000, 2000);
      setupClockTick('.landing-card .clock-r', -1, 6, 1000, 2000);

    })();
  </script>
<!-- Service Worker Registration for PWA -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/sw.js')
          .then(registration => {
            console.log('✅ SW registered:', registration.scope);
          })
          .catch(error => {
            console.log('❌ SW registration failed:', error);
          });
      });
    }
  </script>
</body>
</html> 

<!--
================================================================================
END OF layout.html - Author: Argon Admin
================================================================================
-->
