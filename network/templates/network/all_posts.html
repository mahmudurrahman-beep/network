{# network/templates/network/all_posts.html #}
{% extends "network/layout.html" %}
{% load static %}
{% load parse_media %}

{% block body %}
<style>
/* Post composer - Bootstrap 4 compatible */
.post-composer .file-indicator{
  display:none;
  margin-top:10px;
  padding:10px 12px;
  border:1px solid #e2e8f0;
  border-radius:12px;
  background:#f8fafc;
  align-items:center;
  gap:10px;
}
.post-composer .file-indicator.show{display:flex;}
.post-composer .remove-files{
  margin-left:auto;
  border:1px solid #f87171;
  background:#fff;
  color:#dc2626;
  padding:6px 10px;
  border-radius:10px;
  font-weight:600;
  font-size:12px;
  cursor:pointer;
}
.post-composer .remove-files:hover{background:#fee2e2;}

.post-composer .attach-btn{
  display:inline-flex;
  align-items:center;
  gap:8px;
  border:2px solid #e5e7eb;
  background:#fff;
  padding:10px 14px;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
  color:#6b7280;
}
.post-composer .attach-btn:hover{
  border-color:#3b82f6;
  color:#3b82f6;
  background:#eff6ff;
}

.post-composer textarea{min-height:90px;}
@media (max-width:576px){
  .post-composer textarea{min-height:80px;}
}
</style>

<div class="container my-4">
  {% if user.is_authenticated %}
    <div class="card mb-4 shadow-sm post-composer">
      <div class="card-body">
        <h5 class="card-title">Create New Post</h5>

        <form id="new-post-form" enctype="multipart/form-data">
          {% csrf_token %}

          <textarea name="content"
                    class="form-control mb-3"
                    rows="3"
                    placeholder="Post something..."
                    required></textarea>

          {# Keep file input functional, but use attach button for mobile-friendly UI #}
          <div class="d-flex flex-wrap gap-2 align-items-center">
            <label class="attach-btn" for="media_files">
              <i class="fas fa-paperclip"></i> {# Changed from bi to fas #}
              <span>Attach photos/videos</span>
            </label>
            <input type="file"
                   name="media_files"
                   id="media_files"
                   class="d-none"
                   multiple
                   accept="image/*,video/*">
          </div>

          <div class="file-indicator" id="post-file-indicator">
            <i class="fas fa-check-circle text-success"></i> {# Changed from bi to fas #}
            <span id="post-file-name"></span>
            <button type="button" class="remove-files" id="post-remove-files">
              <i class="fas fa-times me-1"></i>Remove {# Changed from bi to fas #}
            </button>
          </div>

          <button type="submit" class="btn btn-primary mt-3">Post</button>
        </form>

        <div id="post-message" class="mt-3 alert d-none"></div>
      </div>
    </div>
  {% endif %}

  <h4>All Posts</h4>

  {% if page_obj %}
    {% include "network/partials/post_list.html" %}
  {% else %}
    <div class="text-center py-5">
      <h5 class="text-muted">No posts to show</h5>
    </div>
  {% endif %}
</div>

<script>
/* Post file indicator (safe, minimal, doesn't change your existing submit logic) */
(function () {
  const input = document.getElementById('media_files');
  const indicator = document.getElementById('post-file-indicator');
  const nameEl = document.getElementById('post-file-name');
  const removeBtn = document.getElementById('post-remove-files');

  if (!input || !indicator || !nameEl || !removeBtn) return;

  input.addEventListener('change', () => {
    const files = Array.from(input.files || []);
    if (!files.length) {
      indicator.classList.remove('show');
      nameEl.textContent = '';
      return;
    }
    const count = files.length;
    nameEl.textContent = count === 1
      ? `${files[0].name}`
      : `${count} files selected`;
    indicator.classList.add('show');
  });

  removeBtn.addEventListener('click', () => {
    input.value = '';
    indicator.classList.remove('show');
    nameEl.textContent = '';
  });
})();
</script>
{% endblock %}
